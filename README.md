# Soccer Assistant Coach

Includes:
- Different Teams
- Configurable Formations
- Time tracking and stopwatch
- Metrics with CSV export
- Automated position assignments

## Theming & Navigation Consistency

The app now supports dynamic team-aware theming to provide a consistent visual identity across screens:

### Core Concepts
1. Base App Theme: Defined in `lib/core/theme.dart` (Material 3 + brand seed) used when no team context is active.
2. Team Theme: Generated by `TeamTheme` in `lib/utils/team_theme.dart` and exposed via `teamThemeProvider` in `lib/core/team_theme_manager.dart`.
3. Team Scope: Wrap any screen needing team colors with `TeamScaffold(teamId: ...)` or manually with `TeamThemeScope`.
4. Game Scope: For game-centric pages use `GameScaffold(gameId: ...)` which resolves the team automatically from the game → applies theming.
5. Unified Headers: Use `TeamAppBar` for all screens instead of raw `AppBar` to ensure consistent layout, typography, and adaptive coloring.

### Usage Patterns

```dart
// Basic team screen
return TeamScaffold(
	teamId: teamId,
	appBar: TeamAppBar(teamId: teamId, titleText: 'Players'),
	body: ...,
);

// Non-team global screen
return TeamScaffold(
	appBar: const TeamAppBar(titleText: 'Teams'),
	body: ...,
);

// Game screen (teamId auto-resolved from gameId)
return GameScaffold(
	gameId: gameId,
	appBar: TeamAppBar(teamId: null, titleText: 'Game'), // team colors applied by GameScaffold
	body: ...,
);
```

### Guidelines
- Always prefer `TeamScaffold`/`GameScaffold` + `TeamAppBar` over raw `Scaffold` + `AppBar`.
- Avoid duplicating gradient/header logic; use `TeamBrandedHeader` for large branded hero sections.
- For cards/panels that need team accenting, derive colors from `TeamTheme.colorScheme` or use `TeamColorContrast.onColorFor` for readable foregrounds.
- Keep interactive elements (FABs, primary buttons) using the team primary color, with contrast chosen via the contrast helper.
- Game entry: Routes that know only a `gameId` should build a `GameScaffold` (auto resolves team) instead of fetching the team manually.

### Migrating Existing Screens
1. Replace `Scaffold(` with `TeamScaffold(teamId: maybeTeamId, ...)` (or `GameScaffold(gameId: ...)`).
2. Replace `AppBar(` with `TeamAppBar(teamId: maybeTeamId, titleText: 'Title')` (pass `teamId: null` inside a `GameScaffold`—it will theme anyway).
3. Remove ad-hoc color / gradient header widgets; rely on `TeamAppBar` + optional `TeamBrandedHeader`.
4. Move any opponent/date/time composite rows into a `TeamAppBar` `title` widget if still needed.
5. Use `Theme.of(context).colorScheme.*` instead of hard-coded colors.
6. Delete obsolete bespoke header widgets or gradients (see commit history for removed variants).

### GameScaffold
`GameScaffold` lives in `lib/core/game_scaffold.dart` and simply:
* Looks up the `Game` by `gameId`.
* Extracts `teamId`.
* Wraps a `TeamScaffold(teamId: resolvedTeamId, ...)`.

This removes repeated FutureBuilders in every game screen and unifies the theming pipeline. If you previously had:
```dart
final game = await db.getGame(gameId); // in build
final team = await db.getTeam(game.teamId);
return Scaffold(appBar: AppBar(... team colors ...), body: ...);
```
Replace it with:
```dart
return GameScaffold(
	gameId: gameId,
	appBar: TeamAppBar(teamId: null, titleText: 'Game'),
	body: YourBody(gameId: gameId),
);
```

### Header Pattern Recap
* Simple listing/detail pages → `TeamAppBar(titleText: 'X')`.
* Rich hero section (logo + name + meta) → place a `TeamBrandedHeader` at top of body inside padding.
* Game live screens (`GameScreen`, `TraditionalGameScreen`) now use `GameScaffold` + dynamic `TeamAppBar` title.

### Testing Guidance
Widget tests now cover core theming behaviors. See:
* `test/team_app_bar_test.dart` – verifies fallback title (no `teamId`) and team name rendering when a team exists. Uses `AppDb.test()` (in‑memory) for fast setup.
* `test/game_scaffold_test.dart` – ensures `GameScaffold` resolves `teamId` from `gameId` and the body renders once futures complete.

#### Adding More Tests
1. Prefer `AppDb.test()` for in‑memory DB fixtures; insert minimal rows with `TeamsCompanion.insert(name: 'X')` or `GamesCompanion.insert(teamId: teamId)`.
2. Wrap widgets in a `ProviderScope(overrides: [dbProvider.overrideWithValue(db)])` to inject your test database.
3. Use `await tester.pumpAndSettle()` to allow async lookups (team/game fetch + theme provider) to resolve.
4. For color assertions, read `Theme.of(context).colorScheme` from a finder and compare expected hex (e.g., team primary color).
5. Compact headers: If you introduce additional compact layouts (e.g., in `TraditionalGameScreen`), snapshot test the Row contents (logo, opponent, time).

#### Example Snippet
```dart
final db = AppDb.test();
final teamId = await db.addTeam(TeamsCompanion.insert(name: 'Demo FC'));
await tester.pumpWidget(ProviderScope(
	overrides: [dbProvider.overrideWithValue(db)],
	child: MaterialApp(home: TeamScaffold(
		teamId: teamId,
		appBar: TeamAppBar(teamId: teamId, titleText: 'Ignored'),
		body: const SizedBox(),
	)),
));
await tester.pumpAndSettle();
expect(find.text('Demo FC'), findsOneWidget);
```

Run tests:
```
flutter test
```
They should complete quickly (<2s locally) since the database is pure in‑memory.

## Enhancement Ideas / Roadmap
- Dark mode override toggle (user preference independent of system setting).
- Animated transitions when switching between teams (e.g., cross-fade brand colors).
- Accessibility contrast audit & automated contrast lints for custom gradients.
- Bottom navigation / quick team switcher if multi-team juggling becomes common.
- Offline caching layer for teams/games to reduce initial FutureBuilder flashes.
- Theming preview screen to tweak primary/secondary colors with live contrast indicators.
- Haptic/audio feedback customization for shift-change / half-time alerts.
- Performance instrumentation around large game screens (profiling scroll + rebuilds).


Todo's:
Could you add an icon to the status bar for when this app is in the background?
Not shift-based, just single substitutions.
Better game time metric taking (goals, etc.).
All time metrics


